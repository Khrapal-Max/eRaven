@using eRaven.Domain.Enums
@using Blazored.FluentValidation

<div class="modal fade @(_show ? "show d-block" : "")" tabindex="-1">
    <div class="modal-dialog modal-xxl modal-dialog-centered" style="--bs-modal-width:1280px; max-width:1280px;">
        <div class="modal-content">

            <div class="modal-header py-2">
                <h6 class="modal-title mb-0 text-white">Нова планова дія</h6>
                <button type="button" class="btn-close" @onclick="Close"></button>
            </div>

            <div class="modal-body p-3">
                <EditForm Model="CreatePlanAction" OnValidSubmit="CreateAction">
                    <FluentValidationValidator @ref="_validator" />

                    <div class="row g-2">
                        <!-- Ліва колонка: снапшот (read-only) -->
                        <div class="col-12 col-lg-5">
                            <div class="card shadow-sm h-100">
                                <div class="card-body p-2">
                                    <div class="fw-semibold mb-2 small">Дані особи (снапшот)</div>

                                    <div class="mb-1">
                                        <label class="form-label small mb-1">РНОКПП</label>
                                        <input class="form-control form-control-sm" value="@CreatePlanAction?.Rnokpp" disabled />
                                    </div>

                                    <div class="mb-1">
                                        <label class="form-label small mb-1">ПІБ</label>
                                        <input class="form-control form-control-sm" value="@CreatePlanAction?.FullName" disabled />
                                    </div>

                                    <div class="row g-2">
                                        <div class="col-6">
                                            <label class="form-label small mb-1">Звання</label>
                                            <input class="form-control form-control-sm" value="@CreatePlanAction?.RankName" disabled />
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small mb-1">Позивний</label>
                                            <input class="form-control form-control-sm" value="@CreatePlanAction?.Callsign" disabled />
                                        </div>
                                    </div>

                                    <div class="mb-1 mt-2">
                                        <label class="form-label small mb-1">Посада / Підрозділ</label>
                                        <input class="form-control form-control-sm" value="@CreatePlanAction?.PositionName" disabled />
                                    </div>

                                    <div class="row g-2">
                                        <div class="col-6">
                                            <label class="form-label small mb-1">БЗВП</label>
                                            <input class="form-control form-control-sm" value="@CreatePlanAction?.BZVP" disabled />
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small mb-1">Зброя</label>
                                            <input class="form-control form-control-sm" value="@CreatePlanAction?.Weapon" disabled />
                                        </div>
                                    </div>

                                    <div class="mt-2">
                                        <label class="form-label small mb-1">Поточний статус</label>
                                        <input class="form-control form-control-sm" value="@_status" disabled />
                                    </div>

                                    <div class="mt-2">
                                        <label class="form-label small mb-1">Статус на дату (текст)</label>
                                        <input class="form-control form-control-sm" value="@CreatePlanAction?.StatusKindOnDate" disabled />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Права колонка: параметри дії -->
                        <div class="col-12 col-lg-7">
                            <div class="card shadow-sm h-100">
                                <div class="card-body p-2">
                                    <div class="fw-semibold mb-2 small">
                                        Параметри дії
                                        @if (IsReadonly)
                                        {
                                            <small class="text-muted ms-2">(режим «тільки дата/хвилини»)</small>
                                        }
                                    </div>

                                    <!-- Дата + година + хвилини (00/30) -->
                                    <div class="row g-2 align-items-end">
                                        <div class="col-6">
                                            <label class="form-label small mb-1">Дата (UTC)</label>
                                            <input type="date"
                                                   class="form-control form-control-sm"
                                                   value="@_dateLocalString"
                                                   @onchange="OnDateChanged" />
                                            <ValidationMessage For="() => CreatePlanAction!.EffectiveAtUtc" />
                                        </div>
                                        <div class="col-3">
                                            <label class="form-label small mb-1">Година</label>
                                            <select class="form-select form-select-sm" value="@_hourLocalString" @onchange="OnHourChanged">
                                                @for (var h = 0; h <= 23; h++)
                                                {
                                                    <option value="@h.ToString("00")">@h.ToString("00")</option>
                                                }
                                            </select>
                                        </div>
                                        <div class="col-3">
                                            <label class="form-label small mb-1">Хвилини</label>
                                            <select class="form-select form-select-sm" value="@_minuteLocalString" @onchange="OnMinuteChanged">
                                                <option value="00">00</option>
                                                <option value="30">30</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row g-2 mt-2">
                                        <div class="col-6">
                                            <label class="form-label small mb-1">Дія</label>
                                            <InputSelect TValue="MoveType"
                                                         @bind-Value="CreatePlanAction!.MoveType"
                                                         class="form-select form-select-sm"
                                                         disabled="@IsReadonly">
                                                <option value="@MoveType.Dispatch">Відрядити</option>
                                                <option value="@MoveType.Return">Повернути</option>
                                            </InputSelect>
                                            <ValidationMessage For="() => CreatePlanAction!.MoveType" />
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small mb-1">Номер рапорта</label>
                                            <InputText class="form-control form-control-sm"
                                                       @bind-Value="CreatePlanAction!.PlanActionName" />
                                            <ValidationMessage For="() => CreatePlanAction!.PlanActionName" />
                                        </div>
                                    </div>

                                    <div class="row g-2 mt-1">
                                        <div class="col-12">
                                            <label class="form-label small mb-1">Локація</label>
                                            <InputText class="form-control form-control-sm"
                                                       @bind-Value="CreatePlanAction!.Location"
                                                       disabled="@IsReadonly" />
                                            <ValidationMessage For="() => CreatePlanAction!.Location" />
                                        </div>

                                        <div class="col-6">
                                            <label class="form-label small mb-1">Група</label>
                                            <InputText class="form-control form-control-sm"
                                                       @bind-Value="CreatePlanAction!.GroupName"
                                                       disabled="@IsReadonly" />
                                            <ValidationMessage For="() => CreatePlanAction!.GroupName" />
                                        </div>

                                        <div class="col-6">
                                            <label class="form-label small mb-1">Екіпаж</label>
                                            <InputText class="form-control form-control-sm"
                                                       @bind-Value="CreatePlanAction!.CrewName"
                                                       disabled="@IsReadonly" />
                                            <ValidationMessage For="() => CreatePlanAction!.CrewName" />
                                        </div>
                                    </div>

                                    <div class="mt-2">
                                        <label class="form-label small mb-1">Нотатка</label>
                                        <InputText class="form-control form-control-sm"
                                                   @bind-Value="CreatePlanAction!.Note" />
                                        <ValidationMessage For="() => CreatePlanAction!.Note" />
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="text-end mt-3">
                        <button class="btn btn-outline-secondary btn-sm me-2" type="button" @onclick="Close">Скасувати</button>
                        <button class="btn btn-primary btn-sm" type="submit">Зберегти</button>
                    </div>
                </EditForm>
            </div>

        </div>
    </div>
</div>
